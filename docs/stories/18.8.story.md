# Story 18.8: Agency Dashboard Integration

## Status: Ready

## Story

As an **agency owner** (the user who created the agency),
I want **a dashboard to manage my agency profile and view performance metrics**,
So that **I can maintain our presence and track our effectiveness on the platform**.

## Story Context

**Existing System Integration:**
- Integrates with: User dashboard, existing listing dashboard, analytics system
- Technology: Next.js 14, React, TypeScript, Chart.js/Recharts for visualizations
- Follows pattern: Similar to existing listing dashboard patterns
- Touch points: Navigation, user roles, analytics tracking

## Acceptance Criteria

**Functional Requirements:**

1. **Dashboard Access**:
   - "Agency Dashboard" menu item for agency owners
   - Route: `/dashboard/agency` or tab within existing dashboard
   - Redirect non-agency users to registration
2. **Profile Overview Section**:
   - Current profile status (approved/pending/draft)
   - Version history with status indicators
   - Quick stats: team size, linked listings count
   - Last updated timestamp
3. **Quick Actions**:
   - Edit Profile button (creates new version)
   - Manage Team Members
   - View Public Profile
   - Submit for Approval (if draft exists)
4. **Team Management**:
   - List of current team members
   - Add/Edit/Remove team members inline
   - Reorder team members
   - Bulk actions (remove multiple)
5. **Linked Listings**:
   - Table of all linked listings
   - Columns: Company, Status, Date Linked, Views
   - Sort and filter capabilities
   - Click to view listing details
6. **Analytics** (if data available):
   - Profile views over time (30/60/90 days)
   - Contact clicks (email/phone)
   - Top referral sources
   - Company logo impressions

**Permission Requirements:**

7. Only agency owners can access dashboard
8. Non-agency users see CTA to create agency

**Performance Requirements:**

10. Dashboard loads in <2 seconds
11. Metrics update every 15 minutes
12. Export data to CSV functionality

## Technical Notes

**Implementation Decision:**
- Option A: Separate Agency Dashboard (`/dashboard/agency`)
- Option B: Integrated tab in existing dashboard
- Recommendation: Start with Option B for consistency, migrate if needed

**Component Structure:**
```
/app/dashboard/page.tsx - Updated with agency tab
/components/dashboard/AgencyDashboard.tsx - Main component
/components/dashboard/AgencyMetrics.tsx - Analytics widgets
/components/dashboard/LinkedListingsTable.tsx - Listings table
/components/dashboard/TeamQuickEdit.tsx - Inline team editing
/lib/agency-analytics.ts - Metrics calculations
```

**Data Fetching:**
```typescript
// Parallel data fetching for dashboard
const [profile, team, listings, metrics] = await Promise.all([
  getAgencyProfile(agencyId),
  getTeamMembers(agencyId),
  getLinkedListings(agencyId),
  getAgencyMetrics(agencyId, dateRange)
]);
```

**Analytics Events:**
```typescript
// Track key metrics
trackEvent('agency_profile_view', { agency_id });
trackEvent('agency_contact_click', { agency_id, type: 'email' });
trackEvent('agency_logo_impression', { agency_id, listing_id });
```

**Cache Strategy:**
- Dashboard data: 15-minute cache
- Metrics: Pre-calculated hourly
- Team/listings: Real-time with optimistic updates

## Definition of Ready

- [x] Acceptance criteria defined
- [x] Dashboard approach decided
- [x] Metrics to track identified
- [ ] UI/UX mockups approved
- [ ] Analytics implementation plan
- [ ] Story pointed by team

## Definition of Done

- [ ] Dashboard component implemented
- [ ] Profile overview section complete
- [ ] Team management functional
- [ ] Linked listings table working
- [ ] Analytics widgets displaying
- [ ] Role-based access enforced
- [ ] Export functionality added
- [ ] Performance optimized
- [ ] Unit tests >80% coverage
- [ ] Integration tests for data fetching
- [ ] Responsive design verified
- [ ] Analytics tracking confirmed
- [ ] Documentation updated
- [ ] Deployed to staging
- [ ] Product Owner sign-off