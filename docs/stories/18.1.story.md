# Story 18.1: Agency Directory Landing Page

## Status: Ready

## Story

As a **platform visitor**,
I want **to browse and search for property agencies on a dedicated directory page**,
So that **I can discover agencies that match my sector and geographic needs**.

## Story Context

**New System Integration:**
- Integrates with: Main navigation, new `/agents` route
- Technology: Next.js 14, React, TypeScript, Tailwind CSS, Redis for randomization
- Follows pattern: Existing listing search and filter patterns
- Touch points: Navigation bar, search infrastructure, responsive design system

## Acceptance Criteria

**Functional Requirements:**

1. **Navigation Access**: "Agent Directory" link added to main navigation bar, routing to `/agents`
2. **Randomized Display**: Agency tiles displayed in randomized order on each page load (using Redis seed with 5-minute TTL)
3. **Tile Information**: Each agency tile displays:
   - Company logo (with fallback to initials)
   - Company name
   - Classification badge (Commercial/Residential/Both)
   - Geographic patch
4. **Search Functionality**: Real-time search bar that filters agencies by name with debouncing (300ms)
5. **Sector Filtering**: Filter toggles for Commercial, Residential, and Both with URL state persistence
6. **Combined Search & Filter**: Search and filters work together (e.g., search "Savills" within "Commercial")
7. **Responsive Design**: Mobile-first responsive layout with appropriate breakpoints

**Performance Requirements:**

8. Page load time < 2 seconds with up to 500 agencies
9. Search response time < 200ms after debounce
10. Lazy loading for agency logos/images

**Quality Requirements:**

11. Accessibility WCAG 2.1 AA compliant
12. SEO-optimized with proper meta tags and structured data
13. Unit tests for randomization and filtering logic
14. E2E tests for search and filter interactions

## Technical Notes

**Implementation Approach:**
- Use `react-window` for virtualized scrolling with large datasets
- Implement Elasticsearch integration for search (fallback to PostgreSQL full-text search)
- Redis for randomization seed storage
- Next.js Image component for optimized image loading

**Component Structure:**
```
/app/agents/page.tsx - Main directory page
/components/agency/AgencyGrid.tsx - Grid layout component
/components/agency/AgencyCard.tsx - Individual agency tile
/components/agency/AgencyFilters.tsx - Filter controls
/lib/agencies.ts - Agency data fetching and filtering logic
```

**API Endpoints:**
- `GET /api/agencies?search=&sector=&page=&limit=` - Paginated agency list

## Definition of Ready

- [x] Acceptance criteria defined
- [x] Technical approach documented
- [x] Dependencies identified (Redis, search infrastructure)
- [ ] Designs/mockups approved
- [ ] Test scenarios defined
- [ ] Story pointed by team

## Definition of Done

- [ ] Code complete and peer reviewed
- [ ] Unit tests written (>80% coverage)
- [ ] Integration tests passing
- [ ] Acceptance criteria verified
- [ ] Responsive design tested on mobile/tablet/desktop
- [ ] Performance benchmarks met
- [ ] Accessibility audit passed
- [ ] Documentation updated
- [ ] Deployed to staging
- [ ] Product Owner sign-off