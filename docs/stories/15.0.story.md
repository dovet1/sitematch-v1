# Story: Immersive Listing Detail Modal with Full-Screen Desktop Experience

## Status: Ready for Development

## Story

- As a property agent or occupier browsing the commercial directory
- I want to view listing details in an immersive full-screen modal with visual maps and premium animations
- So that I have an engaging, professional experience that showcases all listing information effectively

## Acceptance Criteria (ACs)

### **AC1: Full-Screen Modal Layout**
- [ ] Modal takes full screen on desktop (100vh/100vw) with split layout
- [ ] Left section (40% width) contains visual hero content
- [ ] Right section (60% width) contains scrollable information panels
- [ ] Mobile uses full-screen vertical stack layout
- [ ] Header bar with close button and action buttons (Save, Contact)

### **AC2: Adaptive Visual Hero Section**
- [ ] Show interactive map when listing has location data
- [ ] Show nationwide coverage visual when no specific locations
- [ ] Show image gallery when fit-out images available
- [ ] Show site plans viewer when site plans available
- [ ] Smooth transitions between content types with indicators

### **AC3: Interactive Map Integration**
- [ ] Mapbox GL JS with violet bloom custom styling
- [ ] Animated custom markers for each location
- [ ] Popup details on marker hover/click
- [ ] Auto-fit bounds to show all markers
- [ ] Location count badge overlay

### **AC4: Nationwide Coverage Visualization**
- [ ] UK map outline with animated pulse effects
- [ ] Floating particles and gradient mesh background
- [ ] "Nationwide Coverage" text overlay with globe icon
- [ ] Violet bloom themed animations and colors

### **AC5: Information Panel with Tabbed Navigation**
- [ ] Company hero card with logo, name, and key stats
- [ ] Tab navigation: Overview, Requirements, Locations/Coverage, Documents, Contact
- [ ] Smooth tab transitions with active state indicators
- [ ] Scrollable content within each tab
- [ ] Premium styling with violet bloom accent colors

### **AC6: Premium Animations and Micro-interactions**
- [ ] Modal entry: backdrop fade → scale up → stagger content
- [ ] Tab switching with slide transitions
- [ ] Hover effects on interactive elements
- [ ] Loading states with skeleton screens
- [ ] Framer Motion animations throughout

### **AC7: Responsive Design**
- [ ] Desktop: Split layout with visual hero + info panel
- [ ] Tablet: Adjusted proportions (45%/55% split)
- [ ] Mobile: Full-screen vertical stack with swipe gestures
- [ ] Touch-optimized interactive elements (44px minimum)

### **AC8: Violet Bloom Theme Consistency**
- [ ] Custom map styling with violet-tinted terrain
- [ ] Gradient effects using violet color palette
- [ ] Glass morphism effects with violet tints
- [ ] Consistent with existing site theme

### **AC9: Data Graceful Degradation**
- [ ] Handle missing location data gracefully
- [ ] Show alternative content when images unavailable
- [ ] Hide empty sections rather than showing placeholders
- [ ] Maintain visual appeal regardless of data completeness

### **AC10: Performance and Accessibility**
- [ ] Lazy load Mapbox GL JS and heavy components
- [ ] Keyboard navigation support
- [ ] Screen reader compatible
- [ ] 60fps animations on mid-range devices
- [ ] Reduced motion support

## Tasks / Subtasks

### **Task 1: Create Base Modal Structure**
- [x] Create ImmersiveListingModal component with Framer Motion
- [x] Implement full-screen modal container with backdrop
- [x] Add header bar with close and action buttons
- [x] Create split layout structure for desktop
- [x] Add mobile-responsive vertical layout

### **Task 2: Implement Visual Hero Section**
- [x] Create VisualHeroSection component with adaptive content
- [x] Implement useHeroContent hook for content prioritization
- [x] Create content type indicators
- [x] Add smooth transitions between content types

### **Task 3: Build Interactive Map Component**
- [ ] Integrate Mapbox GL JS with custom violet styling
- [ ] Create custom animated markers
- [ ] Implement marker popups and interactions
- [ ] Add location count badge
- [ ] Handle map bounds and centering

### **Task 4: Create Nationwide Hero Visual**
- [ ] Build UK map outline with SVG
- [ ] Implement animated pulse rings
- [ ] Add floating particles animation
- [ ] Create gradient mesh background
- [ ] Add text overlay with globe icon

### **Task 5: Develop Information Panel**
- [ ] Create CompanyHeroCard component
- [ ] Implement TabNavigation with smooth transitions
- [ ] Build individual tab panels (Overview, Requirements, etc.)
- [ ] Add scrollable content areas
- [ ] Style with violet bloom theme

### **Task 6: Add Premium Animations**
- [x] Implement modal entry animation sequence
- [x] Add tab switching animations
- [x] Create hover and micro-interactions
- [x] Add loading skeleton screens
- [x] Implement stagger animations for lists

### **Task 7: Mobile Optimization**
- [ ] Implement mobile layout with vertical stack
- [ ] Add touch gestures for navigation
- [ ] Optimize content hierarchy for mobile
- [ ] Ensure touch targets meet 44px minimum

### **Task 8: Integrate with Existing System**
- [x] Update ListingCard to use new modal
- [x] Ensure data compatibility with existing API
- [x] Test with various listing data scenarios
- [x] Maintain backward compatibility

### **Task 9: Performance and Accessibility**
- [ ] Implement lazy loading for heavy components
- [ ] Add keyboard navigation support
- [ ] Ensure screen reader compatibility
- [ ] Add reduced motion preferences
- [ ] Optimize for 60fps animations

### **Task 10: Testing and Polish**
- [ ] Unit tests for all components
- [ ] Integration tests for modal interactions
- [ ] Cross-browser testing
- [ ] Performance testing on various devices
- [ ] Accessibility audit with screen readers

## Dev Notes

### **Technical Requirements**
- **Dependencies**: framer-motion, mapbox-gl, @mapbox/mapbox-gl-geocoder
- **Environment Variables**: NEXT_PUBLIC_MAPBOX_TOKEN
- **File Structure**: /components/listings/ImmersiveListingModal/
- **Styling**: CSS Modules with Tailwind classes
- **Performance**: Dynamic imports for heavy components

### **Key Integration Points**
- Replace SimplifiedListingModal in ListingCard component
- Maintain compatibility with EnhancedListingModalContent type
- Use existing API endpoint: `/api/public/listings/{id}/detailed`
- Integrate with existing violet bloom design system

### **Mobile Considerations**
- Full-screen experience on mobile
- Swipe gestures for navigation
- Optimized content hierarchy
- Touch-friendly interactions

### **Accessibility Features**
- ARIA labels for all interactive elements
- Keyboard navigation support
- Screen reader optimized structure
- Reduced motion alternatives
- High contrast support

## Testing

### **Unit Tests**
- Component rendering with various data scenarios
- Hook functionality for content prioritization
- Animation trigger conditions
- Responsive layout behavior

### **Integration Tests**
- Modal open/close functionality
- Tab navigation interactions
- Map integration and marker behavior
- Data loading and error states

### **E2E Tests**
- Complete user journey through modal
- Cross-device responsive behavior
- Performance under various network conditions
- Accessibility with assistive technologies

## Dev Agent Record

### Agent Model Used: Claude Sonnet 4

### Debug Log References

| Task | File | Change | Reverted? |
| ---- | ---- | ------ | --------- |
|      |      |        |           |

### Completion Notes

*Task 8 Integration Complete: Successfully integrated ImmersiveListingModal with existing system. Modal replaces SimplifiedListingModal via updated ListingModal.tsx wrapper. All type interfaces match perfectly, ensuring backward compatibility. Build passes without errors. Ready for Task 9 performance optimization work.*

### Change Log

*Requirement changes only*

### File List

*Complete list of ALL files created/modified during implementation*
- `apps/web/src/components/listings/ImmersiveListingModal/index.tsx` - Main modal component with Framer Motion animations
- `apps/web/src/components/listings/ImmersiveListingModal/ImmersiveListingModal.module.css` - CSS styles for modal layout and animations
- `apps/web/src/components/listings/ImmersiveListingModal/hooks/useHeroContent.ts` - Hook for adaptive hero content prioritization  
- `apps/web/src/components/listings/ImmersiveListingModal/components/VisualHeroSection/index.tsx` - Hero section with content switching
- `apps/web/src/components/listings/ImmersiveListingModal/components/VisualHeroSection/VisualHeroSection.module.css` - Hero section styles
- `apps/web/src/components/listings/ImmersiveListingModal/components/VisualHeroSection/InteractiveMapView.tsx` - Map component placeholder
- `apps/web/src/components/listings/ImmersiveListingModal/components/VisualHeroSection/NationwideHeroVisual.tsx` - Nationwide coverage visual
- `apps/web/src/components/listings/ImmersiveListingModal/components/VisualHeroSection/ImageGallery.tsx` - Image gallery for fit-outs and site plans